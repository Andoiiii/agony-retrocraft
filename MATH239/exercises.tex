\documentclass[class=math239,notes]{agony}
\renewcommand{\thechapter}{\Roman{chapter}}
\titleformat{\section}{\normalfont\large\bfseries}{\thesection}{1em}{}
\settowidth{\cftsecnumwidth}{00~}
\renewcommand\cftsecpresnum{}
\setlist[enumerate,1]{label={(\alph*)}}

\title{MATH 239 Fall 2022: Exercises}
\begin{document}

\tableofcontents
\pagebreak

\chapter{Enumeration}

\section{Basic Principles}

\begin{xca}
  Fix integers $n \geq 0$ and $t \geq 1$.
  Consider a randomly chosen multiset of size $n$ with elements of $t$ types.
  For each part below, calculate the probability that the multiset has the stated property,
  and give a brief explanation.
\end{xca}
\begin{enumerate}
  \item Every type of element occurs at most once.
        \begin{sol}
          Every element either appears or not.
          That is, we have $2^t/\binom{n+t-1}{t-1}$
        \end{sol}
  \item Every type of element occurs at least once.
        \begin{sol}
          This is equivalent to including every element,
          then creating a multiset of the remaining $n-t$ spots.
          That gives $\binom{n-1}{t-1}/\binom{n+t-1}{t-1}$.
        \end{sol}
  \item Every type of element occurs an even number of times.
        \begin{sol}
          Make a multiset of size $\frac{n}{2}$ and then double every item:
          $\binom{\frac{n}{2}-t-1}{t-1}/\binom{n+t-1}{t-1}$.
        \end{sol}
  \item Every type of element occurs an odd number of times.
        % TODO
  \item For $k \in \N$, exactly $k$ types of element occur
        with multiplicity at least one.
        \begin{sol}
          Pick $k$ types, then a multiset of size $n-k$:
          $\binom{t}{k}\binom{n-k+t-1}{t-1}/\binom{n+t-1}{-1}$.
        \end{sol}
  \item For $k \in \N$, exactly $k$ types of element occur
        with multiplicity at least two.
        \begin{sol}
          Pick $k$ types, then a multiset of size $n-2k$:
          $\binom{t}{k}\binom{n-2k+t-1}{t-1}/\binom{n+t-1}{t-1}$.
        \end{sol}
\end{enumerate}

\begin{xca}
  Consider rolling six fair 6-sided dice, which are distinguishable,
  so that there are $6^6 = 46656$ equally likely outcomes.
  Count how many outcomes are of each of the following types:
\end{xca}
\begin{enumerate}
  \item Six-of-a-kind.
        \boxed{6}
  \item Five-of-a-kind and a single.
        \boxed{(6 \cdot 5) \cdot \binom{6}{1} = 180}
  \item Four-of-a-kind and a pair.
        \boxed{(6 \cdot 5) \cdot \binom{6}{4} = 450}
  \item Four-of-a-kind and two singles.
        \boxed{(6 \cdot 5 \cdot 4) \cdot \frac{\binom{6}{4}\binom{2}{1}}{2} = 1800}
  \item Two triples.
        \boxed{(6 \cdot 5) \cdot \frac{\binom{6}{3}}{2} = 300}
  \item A triple, a pair, and a single.
        \boxed{(6 \cdot 5 \cdot 4) \cdot \binom{6}{3}\binom{3}{2} = 7200}
  \item A triple and three singles.
        \boxed{(6 \cdot 5 \cdot 4 \cdot 3) \cdot \frac{\binom{6}{3}\binom{3}{1}\binom{2}{1}}{3\cdot2} = 7200}
  \item Three pairs.
        \boxed{(6 \cdot 5 \cdot 4) \cdot \frac{\binom{6}{2}\binom{4}{2}}{3\cdot2} = 1800}
  \item Two pairs and two singles.
        \boxed{(6 \cdot 5 \cdot 4 \cdot 3) \cdot \frac{\binom{6}{2}\binom{4}{2}}{2\cdot2} = 16200}
  \item One pair and four singles.
        \boxed{(6 \cdot 5 \cdot 4 \cdot 3 \cdot 2)\cdot\binom{6}{2} = 10800}
  \item Six singles. \boxed{6! = 720}
\end{enumerate}

\begin{xca}
  Let $m \geq 1$, $d \geq 2$, and $k \geq 0$ be integers.
  When rolling $m$ fair dice, each of which has $d$ sides,
  what is the probability of rolling exactly $k$ pairs and $m - 2k$ singles
\end{xca}
\begin{sol}
  There are $k+(m-2k) = m-k$ distinct sides in the roll.
  There are $\frac{d!}{(d-(m-k))!}$ ways to pick those sides.

  Then, there are $\binom{m}{2}\binom{m-2}{2}\cdots\binom{m-2(k-1)}{2} = \prod_{i=0}^{k-1} \binom{m-2i}{2}$
  ways to choose the locations of the pairs.
  Since some of these are duplicates, we divide out $k!$ permutations of pairs.

  Finally, this gives us $\frac{d!}{(d-m+k)!k!}\prod_{i=0}^{k-1}\binom{m-2i}{2}$.
\end{sol}

\begin{xca}\end{xca}
\begin{enumerate}
  \item Prove that $\bijects$ is an equivalence relation.
        \begin{prf}
          We must show identity, reflexivity, and transitivity.
          Let $\rl A$, $\rl B$, and $\rl C$ be sets.

          Notice that $\id : \rl A \to \rl A : a \mapsto a$
          is both surjective (there always exists $a$ such that $\id(a) = a$, namely $a$)
          and injective ($\id(a) = \id(b) \implies a = b$).
          Therefore, $\rl A \bijects \rl A$.

          Suppose $\rl A \bijects \rl B$.
          Then, there exists a bijection $f : \rl A \to \rl B$.
          Because $f$ is surjective, a preimage under $f$ exists for all $a \in \rl A$.
          Since $f$ is a injective, the preimage of $a$ under $f$ is a single element $b$.

          Define $g : \rl B \to \rl A$ by that preimage.
          This is surjective (for all $a$, there exists $b = f(a)$ such that $g(b) = a$)
          and injective ($g(b) = g(b') \implies f(g(b)) = f(g(b')) \implies b = b'$).
          Then, $g$ is a bijection and $\rl B \bijects \rl A$.

          Suppose $\rl A \bijects \rl B \bijects \rl C$.
          Then, there exist bijections $f : \rl A \to \rl B$ and $g : \rl B \to \rl C$.
          Define $h = g \circ f : \rl A \to \rl C$.
          Then, for all $c \in \rl C$, there exists $a \in \rl A$
          such that $h(a) = g(f(a)) = c$ because of the surjectivity of $g$ and $f$.
          Also, $h(a) = h(a') \implies g(f(a)) = g(f(a')) \implies f(a) = f(a') \implies a = a'$
          by the injectivity of $g$ and $f$, so $h$ is injective.
          Therefore, $h$ is bijective and $\rl A \bijects \rl C$.

          It follows that $\bijects$ is an equivalence relation.
        \end{prf}
  \item Prove Proposition 1.11.
        \begin{prf}
          Suppose $g(f(a)) = a$ and $f(g(b)) = b$ for all $a \in \rl A$ and $b \in \rl B$.

          \WLOG, consider $f : \rl A \to \rl B$.

          Surjectivity: Let $b \in \rl B$.
          Since $f(g(b)) = b$ and $g(b)$ exists, $f$ is surjective.

          Injectivity: Let $a, a' \in \rl A$ and suppose $f(a) = f(a')$.
          Then, $g(f(a)) = g(f(a'))$ which means $a = a'$ by supposition.

          Therefore, $f$ is bijective and likewise for $g$.

          Now, suppose $f(a) = b$. Then, $g(f(a)) = a = g(b)$.
          Likewise if $g(b) = a$, then $f(g(b)) = b = f(a)$.
          Therefore, $f(a) = b \iff g(b) = a$, as desired.
        \end{prf}
\end{enumerate}

\begin{xca}
  Define $f : \Z \to \N$ as follows: for $a \in \Z$,
  $f(a) = \begin{cases}
      2a    & a \geq 0 \\
      -1-2a & a < 0
    \end{cases}$

  Show that $f$ is a bijection by Proposition 1.11.
\end{xca}
\begin{prf}
  We define the function $g : \N \to \Z : b \mapsto \begin{cases}
      \frac{b}{2}    & b \bmod 2 = 0 \\
      -\frac{b+1}{2} & b \bmod 2 = 1
    \end{cases}$

  Then, consider $g(f(a))$.
  If $a \geq 0$, then $g(f(a)) = g(2a) = \frac{2a}{2} = a$ since $2a$ is even.
  Otherwise, $g(f(a)) = g(-(1+2a)) = -\frac{-(2a+1)+1}{2} = a$ since $-(2a+1)$ is odd.

  Now, consider $f(g(b))$.
  If $b = 2k$ is even, then $f(g(2k)) = f(k) = 2k = b$ since $k \geq 0$ (because $b \in \N$).
  Likewise, if $b = 2k+1$ is odd, then $f(g(2k+1)) = f(-(k+1)) = -1-2(-(k+1)) = 2k+2-1 = 2k+1 = b$.

  Therefore, by Proposition 1.11, $f$ is a bijection.
\end{prf}

\begin{xca}
  Complete Example 1.13.
\end{xca}

\begin{xca}\label{xca:1-7}
  Give bijective proofs of the following identities:
\end{xca}
\begin{enumerate}
  \item For all $n \in \N$, $\sum_{k=0}^n \binom{n}{k}k = n2^{n-1}$
        \begin{prf}
          Consider the set $\rl S$ of subsets of $[n]$ with one ``highlighted'' element.
          For example, $\{1,2,3,\underline{4},10,12\} \subseteq [12]$.

          We can construct $\rl S = \bigcup \rl S_k$
          where $\rl S_k := \{S \in \rl S : \abs{S} = k\}$.
          To construct an element $S$ of $\rl S_k$,
          create a subset of size $k$, of which there are $\binom{n}{k}$,
          then select one of those $k$ elements to highlight.
          This gives $\abs{\rl S_k} = \binom{n}{k}k$.
          As a disjoint union, $\abs{\rl S} = \sum \binom{n}{k}k$.

          Alternatively, construct $S \in \rl S$ directly.
          Pick a single element from $[n]$ to highlight,
          of which there are $n$.
          Then, fill out the rest of the subset using the remaining $n-1$ items,
          of which there are $2^{n-1}$.
          That is, $\abs{\rl S} = n2^{n-1}$.

          Therefore, under the identity bijection,
          $\sum \binom{n}{k}k = \abs{\rl S} = n2^{n-1}$, as desired.
        \end{prf}
  \item For all $n \in \N$, $\sum_{k=0}^n \binom{n}{k}k(k-1) = n(n-1)2^{n-2}$
        \begin{prf}
          Proceed analogously to part (a), but with two highlighted entries in the subset,
          e.g., $\{1,\underline{2},\underline{\overline{4}},6\} \subseteq [10]$.
          Let this set of subsets be $\rl T$.

          As in (a), consider elements of $\rl T_k$.
          We select \emph{two} elements to underline from the $k$ elements in the subset,
          giving us $\binom{n}{k}k(k-1)$.
          Then, as a disjoint union, $\abs{\rl T} = \sum \abs{\rl T_k} = \sum \binom{n}{k}k(k-1)$.

          Again, considering an element of $\rl T$ directly,
          pick two elements to highlight from $n$ and the $n-1$ elements remaining,
          then of the remaining $n-2$ elements construct a subset.
          This gives $\abs{\rl T} = n(n-1)2^{n-2}$.

          Therefore, $\sum \binom{n}{k}k(k-1) = n(n-1)2^{n-2}$, as desired.
        \end{prf}
\end{enumerate}

\begin{xca}
  For an integer $n \geq 1$, give a bijective proof that
  $\sum_{2 \mid n} \binom{n}{k} = \sum_{2 \nmid n} \binom{n}{k}$.
\end{xca}
\begin{prf}
  We must establish a bijection between
  the set of even subsets $\rl E = \{ S \subseteq [n] : 2 \mid \abs{S} \}$
  and the set of odd subsets $\rl O = \{ S \subseteq [n] : 2 \nmid \abs{S} \}$.

  Define $f : S_n \to S_n : f(S) = \begin{cases}
      S \cup \{1\}      & 1 \not\in S \\
      S \setminus \{1\} & 1 \in S
    \end{cases}$

  Let $f_{\rl E}$ and $f_{\rl O}$ be $f$ restricted to the respective set.

  Notice that $f(S)$ always either increases or decreases the size of a set by 1,
  meaning that it will send sets in $\rl E$ to $\rl O$ and vice versa.

  Also, it is obvious that $f(f(S)) = S \cup \{1\} \setminus \{1\}$ or $S \setminus \{1\} \cup \{1\} = S$,
  so $f$ is its own inverse.

  It follows by Proposition 1.11 that $\rl E \bijects \rl O$, as desired.
\end{prf}

\begin{xca}
  Let $n$ be a positive integer.
  Let $\rl S_n$ be the set of ordered pairs of subsets $(A,B)$
  in which $A \subseteq B \subseteq [n]$.
  Let $\rl T_n$ be the set of all functions $f : [n] \to [3]$.
\end{xca}
\begin{enumerate}
  \item What is $\abs{\rl T_n}$?
        \begin{sol}
          Set-theoretically, a function $f : [n] \to [3]$
          is a set of ordered pairs for each value
          $\{(1,f(1)),(2,f(2)),\dotsc,(n,f(n))\}$.
          We pick $n$ values here for $f(1),\dotsc,f(n) \in [3]$.
          That is, $3^n$ choices.
          Therefore, $\abs{\rl T_n} = 3^n$.
        \end{sol}
  \item Define a bijection $g : \rl S_n \to \rl T_n$.
        Explain why $g((A,B)) \in \rl T_n$ for any $(A,B) \in \rl S_n$.
        \begin{sol}
          Given $(A,B) \in \rl S_n$, every element $i \in [n]$ is either:
          (1) not in $A$ or $B$,
          (2) in $B$ but not in $A$, or
          (3) in $A$ (and $B$ since $A \subseteq B$).

          Let $f(i)$ be the number of the case listed above.
          This is a function $[n] \to [3]$, so $f \in \rl T_n$.
        \end{sol}
  \item Define the inverse function $g^{-1} : \rl T_n \to \rl S_n$
        of the bijection $g$ from part (b).
        \begin{sol}
          Construct $A$ and $B$ from $f \in \rl T_n$:

          Read the case list in (b) in reverse. For all $i \in [n]$:
          if $f(i) = 2$, place $i \in B$; if $f(i) = 3$, place $i \in A$.

          Finally, place all elements of $A$ in $B$.
          Then, we have $(A,B) \in \rl S_n$.
        \end{sol}
\end{enumerate}

\begin{xca}
  Fix integers $n \geq 0$ and $k \geq 1$.
  Let $\rl A(n,k)$ be the set of sequences $(a_i) \in \N^k$
  such that $\sum a_i = n$ and $j \mid a_j$ for all $j$.

  Let $\rl B(n,k)$ be the set of sequences $(b_i) \in \N^k$
  such that $\sum b_i = n$ and $b_1 \geq b_2 \geq \dotsb \geq b_k$.

  Construct a pair of mutually inverse bijections
  between the sets $\rl A(n,k)$ and $\rl B(n,k)$.
\end{xca}
\begin{sol}
  \newcommand{\one}{\mathbb{1}}
  Fix $n$ and $k$ and imply the parameters on $\rl A$ and $\rl B$.
  We will treat the sequences as vectors, i.e., $\vb a = (a_1,\dotsc,a_k)$.

  Let $f : \rl A \to \rl B$.
  We will take the sum of vectors of ones.
  Let $\one_i = (\underbrace{1,\dotsc,1}_{\text{$i$ ones}}, \underbrace{0,\dotsc,0}_{\text{$k-i$ zeroes}})$.

  Then, define $f(\vb a) = \sum_{i=1}^k \frac{a_i}{i}\one_i$.
  For example, if $n=7$ and $k=3$,
  \[ f((2,2,3)) = 2(1,0,0) + \frac{2}{2}(1,1,0) + \frac{3}{3}(1,1,1) = (4,2,1) \]
  Notice that since the $\one_i$ are non-increasing for all $i$,
  their linear combination with positive coefficients is also non-increasing.
  Also, we are ``distributing'' the multiples of $i$ into $i$ ones,
  meaning that the sum $\sum a_i = n$ does not change.

  That is, for all $\vb a \in \rl A$, $f(\vb a) = \vb b$ for some $\vb b \in \rl B$.

  We can define an inverse $f^{-1}(\vb b)$ by starting at $i=k$
  and recursively taking out the largest muliple of $i$ from all $k$ entries.

  For the above example, start with $(4,2,1)$ and take out 1 from all 3 entries.
  This sets $a_3 = 1$ and gives $(3,1,0)$.
  Then, take out 1 from the first 2 entries, setting $a_2 = 1$ and giving $(2,0,0)$.
  Finally, take out 2 from the first 1 entry, setting $a_1 = 2$.
  This gives $\vb a = (2,1,1)$, as expected.

  Formally, we define $\vb a = f^{-1}(\vb b)$ as follows:
  \begin{align*}
    a_i'  & = \min\{b_1 - \sum_{j > i} a_i', \dotsc, b_i - \sum_{j > i} a_i'\} \\
    \vb a & = (a_1', 2a_2', \dotsc, ka_k')
  \end{align*}
  which follows the process described above.

  Then, since the processes are inverses, $f$ is a bijection and $\rl A \bijects \rl B$.
\end{sol}

\begin{xca}
  For $n \geq 0$ and $t \geq 2$, prove bijectively that
  $\binom{n+t-1}{t-1} = \sum_{k=0}^n\binom{n-k+t-2}{t-2}$.
\end{xca}
\begin{prf}
  The left-hand side counts the set $\rl S$ of multisets of size $n$ and $t$ types.

  Since there are at least 2 types, partition $\rl S$
  according to the number of times that 1 appears in the multiset.
  Let $\rl S_k = \{ S \in \rl S : \abs{\{1 \in S\}} = k \}$.

  Then, we can ignore the 1's.
  This means to create an element of $\rl S_k$,
  we must create a multiset of size $n-k$ with $t-1$ types
  and then add $k$ 1's.
  This gives us $\abs{\rl S_k} = \binom{(n-k)+(t-1)-1}{(t-1)-1} = \binom{n-k+t-2}{t-2}$.

  Finally, since the number of 1's in a multiset is unique,
  this is a disjoint union and $\abs{\rl S} = \sum \abs{\rl S_k} = \sum \binom{n-k+t-2}{t-2}$.

  Therefore, $\binom{n+t-1}{t-1} = \abs{\rl S} = \sum\binom{n-k+t-2}{t-2}$, as desired.
\end{prf}

\begin{xca}
  For $n \geq 1$ and $t \geq 1$, prove bijectively that
  $\binom{n+t-1}{t-1} = \sum_{k=0}^t\binom{t}{k}\binom{n-1}{k-1}$.
\end{xca}
\begin{prf}
  Again, the LHS counts the set $\rl S$ of multisets of size $n$ and $t$ types.

  Notice that a multiset need not use all $t$ types.
  Consider the set $\rl S_k$ of multisets of size $n$ which use $k \leq t$ types.
  This set will have at least one of each of the $k$ types
  and the remainder is a multiset of $k$ types and size $n-k$.
  That is, there are $\binom{n-k+k-1}{k-1} = \binom{n-1}{k-1}$ of these.
  We also had to pick the $\binom{t}{k}$ types.
  Therefore, $\abs{\rl S_k} = \binom{t}{k}\binom{n-1}{k-1}$.

  Since the number of types used by a multiset is unique,
  this is a disjoint union and $\abs{\rl S} = \sum \abs{\rl S_k} = \sum \binom{t}{k}\binom{n-1}{k-1}$.

  Therefore, $\binom{n+t-1}{t-1} = \abs{\rl S} = \sum\binom{t}{k}\binom{n-1}{k-1}$.
\end{prf}

\begin{xca}
  Choose a permutation $\sigma$ of $\{1, 2, \dotsc, 7\}$ at random,
  so that each of the $7! = 5040$ permutations are equally likely.
  What are the probabilities of the following events?
\end{xca}
\begin{enumerate}[1.]
  \item Numbers 1 and 2 are consecutive
        \begin{sol}
          Let $\sigma_i$ be the index of $i$ in $\sigma$.
          That is, $\sigma_1 = 2$ means 1 is in position 2.

          Consider when 12 appears in the permutation.
          There are 6 choices to place $\sigma_1 = 1,\dotsc,6$
          so that $\sigma_2 = 2,\dotsc,7$.
          There are also 6 choices to place 21.
          Fill the remaining spots with $5!$.
          Therefore, the probability is $\frac{(6+6)5!}{5040} = \frac{2}{7}$.
        \end{sol}
  \item Number 1 is to the left of 2
        \begin{sol}
          There are 7 choices for $\sigma_2$.
          Then, there are $\sigma_2-1$ choices for $\sigma_1$.
          That is, there are $\sum_{\sigma_2=1}^7 (\sigma_2 - 1) = \frac{7\cdot 8}{2} - 7 = 21$
          of these permutations.
          Fill the remaining 5 spots with $5!$.
          Therefore, the probability is $\frac{21\cdot 5!}{5040} = \frac{1}{2}$.
        \end{sol}
  \item No two odd numbers are consecutive
        \begin{sol}
          There are four odd numbers and three evens.
          This means the only way to separate them is to write OEOEOEO.
          We can permute the odd numbers in $4!$ ways and evens in $3!$ ways.
          This gives a probability $\frac{4!\cdot 3!}{5040} = \frac{2}{70}$.
        \end{sol}
\end{enumerate}

\begin{xca}
  Let $r \geq 2$ and $s \geq 2$ be integers.
  Consider a (non-standard) deck of $rs$ cards,
  divided into $s$ suits each with cards of $r$ different values.
  The cards in each suit are numbered $A, 2, 3, \dotsc, r$,
  and $A$ can be either below $2$ or above $r$.
  Choose five cards from such a deck in one of $\binom{rs}{5}$ ways.
  How many ways are there to produce each kind of hand for this
  ``poker in an alternate universe''?
\end{xca}
\begin{enumerate}
  \item Count ``quints'' (five-of-a-kinds).
        \boxed{r}
  \item Count straight flushes.
        \boxed{(r-4)s}
  \item Count quads.
        \boxed{r\binom{s}{4}\cdot\binom{(r-1)s}{1}}
  \item Count full houses.
        \boxed{r\binom{s}{3}\cdot(r-1)\binom{s}{2}}
  \item Count flushes.
        \boxed{s(r! - (r-4))}
  \item Count straights.
        \boxed{(r-4)(5^s - 5)}
  \item Count trips.
        \boxed{r\binom{s}{3}\cdot\qty(s^2\binom{r-1}{2})}
  \item Count two-pairs.
        \boxed{\binom{r}{2}\binom{s}{2}\binom{s}{2}\cdot(s(r-2))}
  \item Count one-pairs.
        \boxed{r\binom{s}{2}\cdot\binom{(r-1)s}{3}}
  \item Count busted hands.
        \boxed{\qty(\binom{r}{5}-(r-4))\cdot(s^5-s)}
\end{enumerate}

\begin{xca}
  The game called ``Crowns and Anchors'' or ``Birdcage''
  was popular on circus midways early in the 20th century.
  It is a game between a Player and the House, played as follows.
  First, the Player wagers $w$ dollars on an integer $p$ from one to six.
  Next, the House rolls three six-sided dice.
  For every die that shows $p$ dots on top, the House pays the Player $w$ dollars,
  but if no dice show $p$ dots on top then the Player's wager is forfeited,
  and goes to the House. (Assume that the dice are fair, so that every outcome is equally likely.)

  For example, if I wager two dollars on the number five,
  and the dice show five, five, and three dots, respectively,
  then the House pays me four dollars for a total of six (a profit of four dollars).
  However, if in this case the dice show four, three, and two dots, respectively,
  then the House takes my wager for a total of zero (a loss of two dollars).
\end{xca}
\begin{enumerate}
  \item For every dollar that the Player wagers,
        how much money should the Player expect to win back in the long run?
        Would you play this game?
        \begin{sol}
          Consider the expected value for each dollar the Player wagers on $k$:

          There are $6^3 = 216$ total outcomes.
          Of these, there is 1 where $k$ appears 3 times,
          5 where $k$ appears twice,
          and $5^2 = 25$ where $k$ appears once.

          This gives an expected value of $\frac{1}{216}(3k + 5(2k) + 25k) = \frac{38}{216}k$.

          The Player will want to maximize payout and always pick $k=6$.

          This gives an expected payout of $\frac{33\cdot6}{216} \approx \$1.06$.
          This is more than the \$1 wager, so the game is worth playing.
        \end{sol}
  \item In a parallel universe there is a game of Crowns and Anchors
        being played with $m \geq 1$ dice, each of which has $d \geq 2$ sides.
        (Assume that the dice are fair, so that every outcome is equally likely.)
        In which universes does the Player win in the long run?
        In which universes does the House win in the long run?
        In which universes is the game completely fair?
        \begin{sol}
          The Player, as above, will always place a dollar on the highest number $d$.

          Then, there are $d^m$ total outcomes.
          For each possible payout $1 \leq i\cdot d \leq m\cdot d$,
          there are $i$ occurrences of $d$
          and there are $(d-1)^{m-i}$ ways to pick the remaining $m-i$ dice.
          As above, we sum to calculate the expected value.

          This gives $\frac{1}{d^m}\sum_{i=1}^m i(d-1)^{m-i}$.
        \end{sol}
\end{enumerate}

\pagebreak
\section{Generating Series}

\begin{xca}
  Calculate the following coefficients
\end{xca}
\begin{enumerate}
  \item $[x^8](1-x)^{-7}$
        \begin{sol}
          Apply the Negative Binomial Series to get $\binom{8+7-1}{7-1} = \binom{14}{6} = 3003$
        \end{sol}
  \item $[x^{10}]x^6(1-2x)^{-5}$
        \begin{sol}
          $[x^{10}]x^6(1-2x)^{-5} = [x^4](1-2x)^{-5}$
          where $(1-2x)^{-5} = \sum \binom{n+5-1}{5-1}2^n x^n$ by NBS
          so we have $\binom{4+5-1}{4} 2^4 = 16\binom{8}{4} = 1120$
        \end{sol}
  \item $[x^8](x^3 + 5x^4)(1+3x)^6$
        \begin{sol}
          Expand: $[x^8](x^3 + 5x^4)(1+3x)^6 = [x^8](x^3(1+3x)^6) + [x^8](5x^4(1+3x^6)) = [x^5](1+3x)^6 + 5[x^4](1+3x)^6$.

          Apply the Binomial Theorem: $(1+3x)^6 = \sum \binom{6}{n} 3^n x^n$
          giving $[x^n](1+3x)^6 = 3^n\binom{6}{n}$.

          Finally, $[x^8](x^3 + 5x^4)(1+3x)^6 = 3^6\binom{6}{5} + 5(3^4\binom{6}{4}) = 10449$
        \end{sol}
  \item $[x^9]((1-4x)^5 + (1-3x)^{-2})$
        \begin{sol}
          Expand: $[x^9]((1-4x)^5 + (1-3x)^{-2}) = [x^9](1-4x)^5 + [x^9](1-3x)^{-2}$.

          Apply BT: $(1+(-4x))^5 = \sum_{n=1}^5 \binom{5}{n} (-4)^n x^n$ so $[x^9](1-4x)^5 = 0$.

          Apply NBS: $(1-3x)^{-2} = \sum \binom{n+2-1}{2-1} 3^n x^n$ so $[x^9](1-3x)^{-2} = 3^9\binom{10}{1} = 196830$
        \end{sol}
  \item $[x^n](1-2tx)^{-k}$
        \begin{sol}
          Apply NBS: $(1-2tx)^{-k} = \sum \binom{n+k-1}{k-1} (2t)^n x^n$,
          so we have $\binom{n+k-1}{k-1}(2t)^n$.
        \end{sol}
  \item $[x^{n+1}]x^k(1-4x)^{-2k}$
        \begin{sol}
          Expand: $[x^{n+1}]x^k(1-4x)^{-2k} = [x^{n-k+1}](1-4x)^{-2k}$.

          Apply NBS: $(1-4x)^{-2k} = \sum \binom{n+2k-1}{2k-1} 4^n x^n$.

          This gives $4^{n-k+1}\binom{n-k+1+2k-1}{2k-1} = 4^{n-k+1}\binom{n+k}{2k-1}$.
        \end{sol}
  \item $[x^n]x^k(1-x^2)^{-m}$
        \begin{sol}
          Expand: $[x^n]x^k(1-x^2)^{-m} = [x^{n-k}](1-x^2)^{-m}$.

          Apply NBS: $(1-x^2)^{-m} = \sum \binom{n+m-1}{m-1} x^{2n}$.

          This gives $[x^n]x^k(1-x^2)^{-m} = \begin{cases*}
              \binom{\frac{n}{2}+m-1}{m-1} & $n$ even \\
              0                            & $n$ odd
            \end{cases*}$
        \end{sol}
  \item $[x^n]((1-x^2)^{-k} + (1-7x^3)^{-k})$
        \begin{sol}
          Expand and apply NBS:
          \begin{align*}
             & [x^n]((1-x^2)^{-k} + (1-7x^3)^{-k})                                                                            \\
             & = [x^n](1-x^2)^{-k} + [x^n](1-7x^3)^{-k}                                                                       \\
             & = [x^n]\sum_{m=0}^\infty\binom{m+k-1}{k-1}x^{2m}
            + [x^n]\sum_{m=0}^\infty\binom{m+k-1}{k-1}7^m x^{3m}                                                              \\
             & = \begin{cases}
                   \binom{\frac{n}{2}+k-1}{k-1} & 2 \mid n  \\
                   0                            & 2 \nmid n
                 \end{cases}
            + \begin{cases}
                7^n\binom{\frac{n}{3}+k-1}{k-1} & 3 \mid n  \\
                0                               & 3 \nmid n
              \end{cases}                                                         \\
             & = \begin{cases}
                   \binom{\frac{n}{2}+k-1}{k-1}                                   & 2 \mid n, 3 \nmid n \\
                   7^n\binom{\frac{n}{3}+k-1}{k-1}                                & 2 \nmid n, 3 \mid n \\
                   \binom{\frac{n}{2}+k-1}{k-1} + 7^n\binom{\frac{n}{3}+k-1}{k-1} & 6 \mid n            \\
                   0                                                              & \text{otherwise}
                 \end{cases}
          \end{align*}
          which is a mess.
        \end{sol}
\end{enumerate}

\begin{xca}
  In each case, find an instance of a Binomial Series that begins as shown.
\end{xca}
\begin{enumerate}
  \item $1-2x+3x^2-4x^3+5x^4-6x^5+\dotsb$
        \begin{sol}
          This has coefficients $(-1)^n(n+1) = (-1)^n\binom{n+2-1}{2-1}$
          which comes from the series $(1+x)^{-2}$.
        \end{sol}
  \item $1+3x+6x^2+10x^3+15x^4+21x^5+\dotsb$
        \begin{sol}
          Coefficients are $\binom{2}{2},\binom{3}{2},\binom{4}{2},\dotsc$
          which match $\binom{n+3-1}{3-1}$,
          which comes from the series $(1-x)^{-3}$.
        \end{sol}
  \item $1-x^3+x^6-x^9+x^{12}-x^{15}+\dotsb$
        \begin{sol}
          Consider $x^{3n}$.
          Coefficients $(-1)^n = (-1)^n\binom{n+1-1}{1-1}$ match $(1+x^3)^{-1}$.
        \end{sol}
  \item $1+2x^2+4x^4+8x^6+16x^8+32x^{10}+\dotsb$
        \begin{sol}
          Consider $x^{2n}$.
          Coefficients $2^n$ match $(1-2x^2)^{-1}$.
        \end{sol}
  \item $1-4x^2+12x^4-32x^6+80x^8-192x^{10}+\dotsb$
        \begin{sol}
          Consider $x^{2n}$.
          Divide through $2^n$ to get $(1, -2, 3, -4, 5, -6)$.
          Coefficients $(-1)^n2^n(n+1) = (-2)^n\binom{n+2-1}{2-1}$
          match $(1+2x^2)^{-2}$
        \end{sol}
  \item $1+6x+24x^2+80x^3+240x^4+672x^5+\dotsb$
        \begin{sol}
          Again, divide through by $2^n$ to get $(3,6,10,\dotsc)$
          which we recognize from (b).
          Coefficients $2^n\binom{n+3-1}{3-1}$
          come from $(1-2x)^{-3}$.
        \end{sol}
\end{enumerate}

\begin{xca}
  Give algebraic proofs of these identities from \Cref{xca:1-7}.
\end{xca}
\begin{enumerate}
  \item For all $n \in \N$, $\sum_{k=0}^n\binom{n}{k}k = n2^{n-1}$
        \begin{prf}
          Recall that $\binom{n}{k} = \frac{n!}{k!(n-k)!}$. Then:
          \begin{align*}
            \sum_{k=0}^n\binom{n}{k}k
             & = \sum_{k=0}^n\frac{n!}{k!(n-k)!}k                 \\
             & = \sum_{k=0}^n\frac{n!}{(k-1)!(n-k)!}              \\
             & = n\sum_{k=0}^n\frac{(n-1)!}{(k-1)!((n-1)-(k-1))!} \\
             & = n\sum_{k=-1}^{n-1}\binom{n-1}{k}                 \\
             & = n2^{n-1}
          \end{align*}
          as desired.
        \end{prf}
  \item For all $n \in \N$, $\sum_{k=0}^n\binom{n}{k}k(k-1) = n(n-1)2^{n-2}$
        \begin{prf}
          As in (a) above:
          \begin{align*}
            \sum_{k=0}^n\binom{n}{k}k(k-1)
             & = \sum_{k=0}^n\frac{n!}{(k-2)!(n-k)!}                   \\
             & = n(n-1)\sum_{k=0}^n\frac{(n-2)!}{(k-2)!((n-2)-(k-2))!} \\
             & = n(n-1)\sum_{k=-2}^{n-2}\binom{n-2}{k}                 \\
             & = n(n-1)2^{n-2}
          \end{align*}
          as desired.
        \end{prf}
\end{enumerate}

\begin{xca}
  Calculate $[x^n](1+x)^{-2}(1-2x)^{-2}$.
  Give the simplest expression you can find.
\end{xca}
\begin{sol}
  First, find $A(x) = (1+x)^{-2} = \sum a_n x^n$
  and $B(x) = (1-2x)^{-2} = \sum b_n x^n$:
  \begin{align*}
    (1+x)^{-2}  & = \sum \binom{n+1}{1} (-1)^n x^n = \sum (-1)^n(n+1)x^n \\
    (1-2x)^{-2} & = \sum \binom{n+1}{1} 2^n x^n = \sum 2^n(n+1)x^n
  \end{align*}
  Then, by definition of multiplication of power series,
  \begin{align*}
    [x^n](1+x)^{-2}(1-2x)^{-2} & = [x^n]A(x)B(x)                                       \\
                               & = [x^n]\sum_{n=0}^\infty \sum_{k=0}^n a_k b_{n-k} x^n \\
                               & = \sum_{k=0}^n (-1)^k(k+1) 2^{n-k}(n-k+1)             \\
                               & = 2^n\sum_{k=0}^n \frac{(k+1)(n-k+1)}{(-2)^k}
  \end{align*}
  which does not look like it's getting simpler.
\end{sol}

\begin{xca}\end{xca}
\begin{enumerate}
  \item Let $a \geq 1$ be an integer. For each $n \in \N$,
        extract the coefficient $x^n$ from both sides of this power series identity:
        \[ \frac{(1+x)^a}{(1-x^2)^a} = \frac{1}{(1-x)^a} \]
        to show that $\binom{n+a-1}{a-1} = \sum_{k=0}^{\floor{n/2}}\binom{a}{n-2k}\binom{k+a-1}{a-1}$
        \begin{prf}
          Apply the Binomial Series to get $[x^n]\frac{1}{(1-x)^a} = \binom{n+a-1}{a-1}$.

          For the left-hand side, consider a product $A(x)\cdot B(x) = (1+x)^a \cdot (1-x^2)^{-a}$.

          Then, the Binomial Theorem gives $A(x) = \sum_{n=0}^a \binom{a}{n} x^n$
          and the Binomial Series gives $B(x) = \sum_{n=0}^\infty \binom{n+a-1}{a-1}x^{2n}$.

          After multiplying, we can consider contributions from $B(x)$.
          We can get $x^{2k}$ for $k = 0,\dotsc,\floor{\frac{n}{2}}$
          leaving $x^{n-2k}$ from $A(x)$.

          This gives a coefficient $\sum_{k=0}^{\floor{n/2}}\binom{a}{n-2k}\binom{k+a-1}{a-1}$.

          Therefore, by definition of equality of power series,
          $\binom{n+a-1}{a-1} = \sum_{k=0}^{\floor{n/2}}\binom{a}{n-2k}\binom{k+a-1}{a-1}$,
          as desired.
        \end{prf}
  \item Can you think of a combinatorial proof?
        \begin{prf}
          We are considering the set of multisets of size $n$ and $a$ types.

          In a multiset, every type $t$ can appear either
          an even $m_t = 2k_t$ or odd $m_t = 2k_t+1$ number of times.
          Let $k = \sum k_t$ and partition the set of multisets on $k$.
          Notice that $\sum m_t = (\sum 2k_t) + \abs{\{t : \text{$m_t$ is odd}\}} = n$,
          which means that there are $n-2k$ types appearing an odd number of times.

          Now, we can instead pick a multiset of size $k$ with $a$ types in $\binom{k+a-1}{a-1}$ ways,
          double every entry, and then add the remainders for the $\binom{a}{n-2k}$ odd entries.
          Since $k$ runs from 0 to $\floor{n/2}$ (above gives $\binom{a}{n-2k}=0$),
          $\binom{n+a-1}{a-1} = \sum_{k=0}^{\floor{n/2}}\binom{a}{n-2k}\binom{k+a-1}{a-1}$,
          as desired.
        \end{prf}
\end{enumerate}

\begin{xca}
  Prove the Infinite Sum Lemma.
\end{xca}
\begin{prf}
  Suppose $\rl A_0,\rl A_1,\rl A_2,\dotsc$ are pairwise disjoint sets
  and let $\rl B = \bigcup_{j=0}^\infty \rl A_j$.
  Also, let $\omega : \rl B \to \N$ be a weight function.
  We want to show that $\Phi_{\rl B}^\omega(x) = \sum_{j=0}^\infty \Phi_{\rl A_j}^\omega(x)$.

  Proceed by the definition of equality and addition for power series.

  Let $\Phi_{\rl A_j}(x) = \sum a_{j,n} x^n$ and $\Phi_{\rl B}(x) = \sum b_n x^n$.

  We must show that $b_n = \sum_{j=0}^\infty a_{j,n}$ for all $n \geq 0$.

  Since $\omega$ is a weight function, $\omega^{-1}(n)$ is a finite set.\footnote{Let $\omega^{-1}(n)$ be the preimage of $n$ under $\omega$.}

  Let $m = \max\{j \in \N : \exists k \in \omega^{-1}(n), k \in \rl A_j\}$,
  the minimum $m$ where $\omega^{-1}(n) \subseteq \bigcup_{j=0}^m \rl A_j$.

  Proceed by induction on $m$ to show that $b_n = \sum_{j=0}^m a_{j,n}$.

  If $m = 0$, then $\omega^{-1}(n) \subseteq \rl A_0$ and we just let $b_n = a_{0,n}$.
  If $m = 1$, then $\omega^{-1}(n) \subseteq \rl A_0 \cup \rl A_1$
  and by the ordinary Sum Lemma, $b_n = [x^n]\Phi_{\rl A_0}(x) + [x^n]\Phi_{\rl A_1}(x) = a_{0,n} + a_{1,n}$.

  Otherwise, $m \geq 1$ and we apply the Sum Lemma to $\rl A_m$ and $\bigcup_{j=0}^{m-1}\rl A_{j-1}$
  to get that $b_n = a_{j,n} + \sum_{j=0}^{m-1} a_{j,n} = \sum_{j=0}^m a_{j,n}$, as desired.

  Then, since $\omega^{-1}(n)$ contains no elements in $\rl A_{m+1},\dotsc$
  we know that $a_{m+1,n} = a_{m+2,n} = \dotsb = 0$ and
  we have that $b_n = \sum_{j=0}^m a_{j,n} = \sum_{j=0}^\infty a_{j,n}$.

  Finally, $\Phi_{\rl B}(x) = \sum \Phi_{\rl A_j}(x)$, as desired.
\end{prf}

\begin{xca}\label{xca:genprodlem}
  Extend the Product Lemma to the product of finitely many sets with weight functions.
\end{xca}
\begin{prf}
  Consider finitely many sets $\rl A_1,\dotsc,\rl A_n$ for $n \geq 2$.
  Let $\rl A = \bigcup_{i=1}^n \rl A$.
  Define a weight function $\omega : \rl A \to \N$ a weight function
  which we can restrict to each set $\rl A_i$.
  On the partial unions $\rl B_j = \bigcup_{i=1}^j \rl A_i$,
  define $\sigma_j : \rl B_j \to \N : (a_1,\dotsc,a_j) \mapsto \sum_{i=1}^j \omega(a_i)$.
  Note that $\rl B_n = \rl A$ and write $\sigma = \sigma_n$.

  Proceed to show that $\Phi_{\rl A}^\omega(x) = \prod \Phi_{\rl A_i}^{\omega}(x)$ by induction.

  If $n = 2$, this is the standard Product Lemma and we get that $\sigma_2$ is a weight function
  and $\Phi_{\rl B_2}^{\omega_2}(x) = \prod_{i=1}^2 \Phi_{\rl A_i}^{\omega}(x)$.

  If $n \geq 3$, suppose that $\Phi_{\rl B_{n-1}}^\omega(x) = \prod_{i=1}^{n-1} \Phi_{\rl A_i}^{\omega}(x)$.

  Then, by the Product Lemma, since $\sigma_n(a_1,\dotsc,a_n)
    = \sigma_{n-1}(a_1,\dotsc,a_{n-1}) + \omega(a_n)$,
  we can say that $\sigma_n$ is a weight function and
  $\Phi_{\rl B_{n-1} \times \rl A_n}^{\sigma_n}(x)
    = \Phi_{\rl A}^\sigma(x)
    = \Phi_{\rl A_n}^{\omega}(x) \cdot \prod_{i=1}^{n-1} \Phi_{\rl A_i}^{\omega}(x)
    = \prod_{i=1}^{n} \Phi_{\rl A_i}^{\omega}(x)$
  as desired.

  Therefore, by induction, the Generalized Product Lemma holds.
\end{prf}

\begin{xca}
  Show that for $m,n,k \in \N$,
  $\sum_{j=0}^k(-1)^j\binom{n+j-1}{j}\binom{m}{k-j} = \binom{m-n}{k}$.
\end{xca}
% TODO

\begin{xca}\end{xca}
\begin{enumerate}
  \item Make a list of all the four-letter ``words''
        that can be formed from the ``alphabet'' $\{a, b\}$.
        Define the weight of a word to be the number of occurrences of $ab$ in it.
        Determine how many words there are of weight 0, 1 and 2.
        Determine the generating series.
        \begin{sol}
          There are $2^4 = 16$ possible words.

          There is one word of weight 2, namely $abab$.

          A single occurrence of $ab$ can be placed at the start, middle, or end.
          If at the start/end, there are 3 ways to fill the other 2 letters ($aa$, $bb$, and $ba$).
          Otherwise, there are 4 (since we do not worry about accidentally making another $ab$).
          This gives $3+4+3 = 10$ words of weight 1.

          The remaining 4 words have weight 0.

          This gives a generating series $4 + 10x + 2x^2$.
        \end{sol}
  \item Do the same for five-letter words over the same alphabet, but preferably,
        without listing the words separately.
        \begin{sol}
          There are $2^5 = 32$ possible words.

          Two occurrences can be placed at the start ($ababX$), end ($Xabab$), or split ($abXab$).
          The $X$ can be either $a$ or $b$, giving $3 \times 2 = 6$ words of weight 2.

          A word with no $ab$ in it can only go from a run of $b$'s to $a$'s,
          so if we consider $b^* a^*$ we have 6 words with weight 0.

          This means there are $32 - 6 - 6 = 20$ words with weight 1.

          This gives a genearting series $6 + 20x + 6x^2$.
        \end{sol}
  \item Do the same for six-letter words.
        \begin{sol}
          There are $2^6 = 64$ possible words.

          Three occurrences fit six letters, so there is 1 word of weight 3.

          Two occurrences can be placed in 4 positions:
          $ababXX$, $abXabX$, $abXXab$, $XababX$, $XabXab$, $XXabab$.
          Like in (a), there are 3, 4, 3, 4, 4, and 3 ways to fill the $X$'s.
          This gives $3 + 4 + 3 + 4 + 4 + 3 = 21$ words of weight 2.

          As in (b), there are 7 words with weight 0.

          There remains $64 - 1 - 21 - 7 = 35$ words with weight 1.

          The generating series is therefore $7 + 35x + 21x^2 + x^3$.
        \end{sol}
\end{enumerate}

\begin{xca}\label{xca:2-dice}\end{xca}
\begin{enumerate}
  \item Consider throwing two six-sided dice, one red and one green.
        The weight of a throw is the total number of pips showing on
        the top faces of both dice (that is, the usual score).
        Make a table showing the number of throws of each weight,
        and write down the generating series.
        \begin{sol}
          Construct the table:
          \begin{center}
            \begin{tabular}{c|l|c}
              Sum & Outcomes          & Count \\ \hline
              0   & $\varnothing$     & 0     \\
              1   & $\varnothing$     & 0     \\
              2   & 11                & 1     \\
              3   & 12 21             & 2     \\
              4   & 13 22 31          & 3     \\
              5   & 14 23 32 41       & 4     \\
              6   & 15 24 33 42 51    & 5     \\
              7   & 16 25 34 43 52 61 & 6     \\
              8   & 26 35 44 53 62    & 5     \\
              9   & 36 45 54 63       & 4     \\
              10  & 46 55 64          & 3     \\
              11  & 56 65             & 2     \\
              12  & 66                & 1
            \end{tabular}
          \end{center}
          with generating series $x^2+2x^3+3x^4+4x^5+5x^6+6x^7+5x^8+4x^9+3x^{10}+2x^{11}+x^{12}$.
        \end{sol}
  \item Do the same as for part (a), but throwing three dice:
        one red, one green, and one white
        \begin{sol}
          Construct the table:
          \begin{center}
            \tiny\begin{tabular}{c|l|c}
              Sum & Outcomes                                                                                                    & Count \\ \hline
              0   & $\varnothing$                                                                                               & 0     \\
              1   & $\varnothing$                                                                                               & 0     \\
              2   & $\varnothing$                                                                                               & 0     \\
              3   & 111                                                                                                         & 1     \\
              4   & 112 121 211                                                                                                 & 3     \\
              5   & 113 122 131 212 221 311                                                                                     & 6     \\
              6   & 114 123 132 141 213 222 231 312 321 411                                                                     & 10    \\
              7   & 115 124 133 142 151 214 223 232 241 313 322 331 412 421 511                                                 & 15    \\
              8   & 116 125 134 143 152 161 215 224 233 242 251 314 323 332 341 413 422 431 512 521 611                         & 21    \\
              9   & 126 135 144 153 162 216 225 234 243 252 261 315 324 333 342 351 414 423 432 441 513 522 531 612 621         & 25    \\
              10  & 136 145 154 163 226 235 244 253 262 316 325 334 343 352 361 415 424 433 442 451 514 523 532 541 613 622 631 & 27    \\
              11  & 146 155 164 236 245 254 263 326 335 344 353 362 416 425 434 443 452 461 515 524 533 542 551 614 623 632 641 & 27    \\
              12  & 156 165 246 255 264 336 345 354 363 426 435 444 453 462 516 525 534 543 552 561 615 624 633 642 651         & 25    \\
              13  & 166 256 265 346 355 364 436 445 454 463 526 535 544 553 562 616 625 634 643 652 661                         & 21    \\
              14  & 266 356 365 446 455 464 536 545 554 563 626 635 644 653 662                                                 & 15    \\
              15  & 366 456 465 546 555 564 636 645 654 663                                                                     & 10    \\
              16  & 466 556 565 646 655 664                                                                                     & 6     \\
              17  & 566 656 665                                                                                                 & 3     \\
              18  & 666                                                                                                         & 1
            \end{tabular}
          \end{center}
          which gives generating series $x^3 + 3x^4 + 6x^5 + 10x^6 + 15x^7 + 21x^8 + 25x^9 + 27x^{10} + 27x^{11} + 25x^{12} + 21x^{13} + 15x^{14} + 10x^{15} + 6x^{16} + 3x^{17} + x^{18}$.
        \end{sol}
\end{enumerate}

\begin{xca}
  Construct a table, as in Exercise 2.10(a),
  if the weight of a throw is defined to be
  the absolute value of the difference between
  the number of pips showing on the two dice.
  Also, write down the generating series.
\end{xca}
\begin{sol}
  Construct the table:
  \begin{center}
    \begin{tabular}{c|l|c}
      Sum & Outcomes                      & Count \\ \hline
      0   & 11 22 33 44 55 66             & 6     \\
      1   & 12 21 23 32 34 43 45 54 56 65 & 10    \\
      2   & 13 24 31 35 42 46 53 64       & 8     \\
      3   & 14 25 36 41 52 63             & 6     \\
      4   & 15 26 51 62                   & 4     \\
      5   & 16 61                         & 2
    \end{tabular}
  \end{center}
  giving generating series $6 + 10x + 8x^2 + 6x^3 + 4x^4 + 2x^5$.
\end{sol}

\begin{xca}
  Let $\rl S$ be the set of ordered pairs $(a, b)$ of integers with $0 \leq \abs{b} \leq a$.
  Each part gives a function $\omega$ defined on the set $\rl S$.
  Determine whether or not $\omega$ is a weight function on the set $\rl S$.
  If it is not, then explain why not.
  If it is a weight function, then determine
  the generating series $\Phi_{\rl S}(x)$ of $\rl S$ with respect to $\omega$,
  and write it as a polynomial or a quotient of polynomials.
\end{xca}
\begin{enumerate}
  \item For $(a,b) \in \rl S$, let $\omega((a,b)) = a$.
        \begin{sol}
          This is a weight function. First, $a \geq 0$ for all $(a,b)$.

          Given finite $a \in \Z$ with $a \geq \abs{b} \geq 0$,
          there are finitely many $b$ to choose from, namely, $-a \leq b \leq a$.
          That is, there are $2a+1$ options for $(a,b)$ given $\omega((a,b)) = a$.

          Therefore, $\Phi_{\rl S}(x) = \sum (2n+1) x^n = 2x\sum n x^{n-1} + \sum x^n
            = \frac{2x}{(1-x)^2} + \frac{1}{1-x} = \frac{1+x}{(1-x)^2}$.
        \end{sol}
  \item For $(a,b) \in \rl S$, let $\omega((a,b)) = a+b$.
        \begin{sol}
          This is not a weight function.
          Notice that $\omega^{-1}(0)$ has infinite size,
          namely, given any $a \geq 0$, set $b = a$ so that $\omega((a,b)) = 0$.
        \end{sol}
  \item For $(a,b) \in \rl S$, let $\omega((a,b)) = 2a+b$.
        \begin{sol}
          This is a weight function. First, $a \geq \abs{b} \geq 0$ means $2a+b \geq 0$.

          Given $\omega((a,b)) = n$, we can construct $n$ as $2a + b$
          for $a = \ceil{\frac{n}{3}},\dotsc,n$
          and corresponding $b = n-2a = n-2\ceil{\frac{n}{3}},\dotsc,-n$.
          That is, $\omega^{-1}(n)$ has size $n-\ceil{\frac{n}{3}}+1$.

          This means $\Phi_{\rl S}(x) = \sum(n-\ceil{\frac{n}{3}}+1)x^n
            = \sum n x^n - \sum\ceil{\frac{n}{3}}x^n + \sum x^n$.
          Write
          \begin{align*}
            \sum\ceil*{\frac{n}{3}}x^n
             & = x + x^2 + x^3 + 2x^4 + 2x^5 + 2x^6 + \dotsb                            \\
             & = (x + 2x^4 + \dotsb) + (x^2 + 2x^5 + \dotsb) + (x^3 + 2x^6 + \dotsb)    \\
             & = x(1 + 2x^3 + \dotsb) + x^2(1 + 2x^3 + \dotsb) + x^3(1 + 2x^3 + \dotsb) \\
             & = (x+x^2+x^3)\sum(n+1)x^{3n}                                             \\
             & = \frac{x+x^2+x^3}{(1-x^3)^2}
          \end{align*}

          By part (a), we know the other series give $\frac{x}{(1-x)^2} - \frac{x+x^2+x^3}{(1-x^3)^2} + \frac{1}{1-x}$.
        \end{sol}
\end{enumerate}

\begin{xca}
  Let $\rl S = [6]^4$ be the set of outcomes when rolling four six-sided dice.
  For $(a,b,c,d) \in S$, define its weight to be $\omega(a,b,c,d) = a+b+c+d$.
  Consider the generating series $\Phi_{\rl S}(x)$ of $\rl S$ with respect to $\omega$.
\end{xca}
\begin{enumerate}
  \item Explain why $\Phi_{\rl S}(x) = \qty(\frac{x-x^7}{1-x})^4$.
        \begin{sol}
          The inner term gives the finite geometric series for $1+x+x^2+x^3+x^4+x^5+x^6$.
          This is exactly $\Phi_{[6]}(x)$.
          By the Generalized Product Lemma (\Cref{xca:genprodlem}),
          the generating series for $\rl S = [6]^4$ is $(\Phi_{[6]}(x))^4$.
        \end{sol}
  \item How many outcomes in $\rl S$ have weight 19?
        % TODO
  \item Let $m$, $d$, $k$ be positive integers.
        When rolling $m$ dice, each of which has exactly $d$ sides,
        how many different ways are there to roll
        a total of $k$ pips on the top faces of the dice?
        \begin{sol}
          The general generating series is $\Phi(x) = \qty(\frac{x-x^{d+1}}{1-x})^m$.
          We want $[x^k]\Phi(x)$.
          % TODO
        \end{sol}
\end{enumerate}

\begin{xca}
  Let $\rl A$ be a set with weight function $\omega : \rl A \to \N$.
  Show that for any $n \in \N$, the number of $\alpha \in \rl A$
  with $\omega(\alpha) \leq n$ is $[x^n]\frac{1}{1-x}\Phi_{\rl A}(x)$.
\end{xca}
\begin{prf}
  By the Binomial Series, $B(x) = \frac{1}{1-x} = 1+x+x^2+\dotsb$, i.e., $b_n = 1$ for all $n$.

  When we multiply $\Phi_{\rl A}(x) = \sum a_n x^n$ by $\frac{1}{1-x}$,
  the product coefficient is by definition $\sum_{i=0}^n a_i b_{n-i} = \sum_{i=0}^n a_i$.
  That is, the sum of the $a_i$ for $i \leq n$.

  But since $a_i$ is the number of elements of $\alpha \in \rl A$ with $\omega(\alpha) = i$,
  we have counted the number of elements $\omega(\alpha) \leq n$.
\end{prf}

\begin{xca}
  For each of the following sets of compositions,
  obtain a rational function formula for the generating series of that set
  with respect to size.
\end{xca}
\begin{enumerate}
  \item Let $\rl A$ be the set of compositions of length congruent to 1 (modulo 3).
        \begin{sol}
          The allowed sizes for a part are $P = \{1,\dotsc,\}$
          so $\Phi_P(x) = \frac{x}{1-x}$.

          We can generate compositions of length $3k+1$ as $P(P^3)^k$.
          In general, $\rl A = P(P^3)^*$.

          Then, by the Product Lemma, the generating series for $P^3$ is $(\frac{x}{1-x})^3$
          and by the String Lemma, the generating series for $(P^3)*$ is
          $\sum (\frac{x}{1-x})^{3j} = \frac{1}{1-x^3/(1-x)^3} = \frac{(1-x)^3}{(1-x)^3-x^3}$.

          Finally, $\Phi_{\rl A}(x) = \frac{x(1-x)^3}{(1-x)(1-3x+3x^2-2x^3)}
            = \frac{x-2x^2+x^3}{1-3x-3x^2-2x^3}$.
        \end{sol}
  \item Let $\rl B$ be the set of compositions of length congruent to 2 (modulo 3).
        \begin{sol}
          Proceed as in (a) up to the last multiplication, then square $\Phi_P$ to get
          $\Phi_{\rl B}(x) = \frac{x^2(1-x)^3}{(1-x)^2(1-3x+2x^2-2x^3)}
            = \frac{x^2 - x^3}{1-3x+2x^2-2x^3}$.
        \end{sol}
  \item Let $\rl C$ be the set of compositions of even length,
        with each part being at most 3.
        \begin{sol}
          Here, $P = \{1,2,3\}$, so $\Phi_P(x) = x+x^2+x^3$.

          Then, to get even length, $\rl C = (P^2)^*$.

          By the Product Lemma, $\Phi_{P^2}(x) = (x+x^2+x^3)^2$
          and by the String Lemma, we have
          $\Phi_{\rl C}(x) = \frac{1}{1-(x+x^2+x^3)^{-2}}
            = \frac{(x+x^2+x^3)^2}{(x+x^2+x^3)^2-1}$.
        \end{sol}
  \item Let $\rl D$ be the set of compositions of odd length,
        with each part being at least 2.
        \begin{sol}
          Let $P = \{2,3,\dotsc\}$ so $\Phi_P(x) = x^2 + x^3 + \dotsb
            = x^2(1 + x + \dotsb) = \frac{x^2}{1-x}$.

          Then, to get odd length, $\rl D = P(P^2)^*$.
          By the Product Lemma, $\Phi_{P^2} = \frac{x^4}{(1-x)^2}$
          and by the String Lemma $\Phi_{(P^2)^*} = \frac{1}{1-x^4(1-x)^{-2}}
            = \frac{(1-x)^2}{(1-x)^2-x^4} = \frac{1-2x+x^2}{1-2x+x^2-x^4}$.

          Finally, by the Product Lemma, $\Phi_{\rl D} = \frac{x^4-2x^5+x^6}{(1-x)(1-2x+x^2-x^4)}
            = \frac{x^4-2x^5+x^6}{1-3x+3x^2-x^3-x^4+x^5}$
        \end{sol}
  \item Let $\rl E$ be the set of compositions $\gamma = (c_i)$ of any length,
        in which each part $c_i$ is congruent to $i$ (modulo 2).
        So $c_1$ is odd, $c_2$ is even, $c_3$ is odd, and so on.
        \begin{sol}
          If $\rl O = \{1,3,5,\dotsc\}$ and $\rl P = \{2,4,6,\dotsc\}$,
          we can write $\rl E = (\rl O\rl P)^* \cup (\rl O\rl P)^*\rl O$
          depending on if the length is even or odd.

          Write $\Phi_{\rl O} = x + x^3 + \dotsb = x(1 + x^2 + \dotsb) = \frac{x}{1-x^2}$
          and $\Phi_{\rl P} = x^2(1 + x^2 + \dotsb) = \frac{x^2}{1-x^2}$.

          Then, by the Product Lemma, $\Phi_{\rl{OP}} = \frac{x^3}{(1-x^2)^2}$
          and by the String Lemma, $\Phi_{(\rl{OP})^*} = \frac{1}{1-x^3(1-x^2)^{-2}}
            = \frac{(1-x^2)^2}{(1-x^2)^2-x^3}$.

          Finally, by the Product and Sum Lemmas,
          $\Phi_{\rl E} = \frac{(1-x^2)^2}{(1-x^2)^2-x^3} + \frac{x(1-x^2)^2}{(1-x^2)((1-x^2)^2-x^3)}$
          and I am too lazy to simplify.
        \end{sol}
\end{enumerate}

\section{Binary Strings}

\begin{xca}
  Prove Lemma 3.9 (Unambiguous Expressions)
\end{xca}
\begin{prf}
  Let $\rx R$ and $\rx S$ be regular expressions producing $\rl R$ and $\rl S$.
  Proceed by cases.

  If $\rx R = \varepsilon$, 0, or 1, then $\rl R = \{\varepsilon\}$, $\{0\}$, or $\{1\}$.
  Notice each is produced exactly once, so $\rx R$ is unambiguous.

  Now, suppose $\rx R$ and $\rx S$ are unambiguous.
  We proceed by contrapositives.

  Suppose $\rx R \smile \rx S$ which produces $\rl R \cup \rl S$ is ambiguous.
  Then, since $\rx R$ and $\rx S$ are unambiguous,
  the union operation must produce a duplicate.
  That is, $\rl R \cap \rl S \neq \varnothing$.
  Conversely, if $\rl R \cap \rl S$ is non-empty,
  then whatever expressions are in the intersection are produced twice by $\rx R \smile \rx S$.
  Therefore, $\rx R \smile \rx S$ is ambiguous if and only if $\rl R \cap \rl S \neq \varnothing$.

  Suppose $\rx R\rx S$ is ambiguous.
  Then, $\rl R \rl S = \{\rho\sigma : \rho \in \rl R, \sigma \in \rl S\}$
  produces some element $\rho\sigma = \rho'\sigma'$ twice.
  Notice that for all $(\rho,\sigma) \in \rl R \times \rl S$, $f(\rho,\sigma) = \rho\sigma \in \rl R \rl S$.
  That is, $\abs{\rl R \times \rl S} \geq \abs{\rl R \rl S}$.
  However, since $\rho\sigma = \rho'\sigma'$, $f$ is not injective.
  Therefore, $\abs{\rl R \times \rl S} \neq \abs{\rl R \rl S}$.
  This means $\rl R\times\rl S \mathrel{\not\bijects} \rl R\rl S$.

  Conversely, suppose $\rl R\times\rl S \mathrel{\not\bijects} \rl R\rl S$.
  Then, $\abs{\rl R \times \rl S} > \abs{\rl R \rl S}$.
  This means that under $f$, multiple pairs must be sent to one string,
  which is exactly what it means for $\rl R\rl S$ to be ambiguous.

  Finally, consider $\rx R^*$ is ambiguous.
  Then, since $\rx R$ is unambiguous, the ambiguity must be introduced
  by either a single $\rx R^k$ being ambiguous or the union.
  By induction on the second point, the union is unambiguous if and only if
  $\bigcup_{k=0}^\infty \rl R^k$ is a disjoint union.
  Therefore, $\rx R^*$ is ambiguous if and only if all the $\rx R^k$ are unambiguous
  and the union of the $\rl R^k$ is disjoint.
\end{prf}

\begin{xca}
  Let $\rx A = (10 \smile 101)$ and $\rx B = (001 \smile 100 \smile 1001)$.
  For each of $\rx{AB}$ and $\rx{BA}$, is the expression unambiguous?
  What is the generating series (by length) of the set it produces?
\end{xca}
\begin{sol}
  Write out $\rl{AB} = \{10001, 10100, 101001, 101001, 101100, 1011001\}$.
  Notice $101001$ appears twice, so $\rx{AB}$ is ambiguous.
  The (meaningless) generating series is $2x^5 + 2x^6 + x^7$.

  Write out $\rl{BA} = \{00110, 001101, 10010, 100101, 100110, 1001101\}$.
  No element appeared twice, so $\rx{BA}$ is unambiguous.
  The generating series is $2x^5 + 3x^6 + x^7$.
\end{sol}

\begin{xca}
  Let $\rx A = (00 \smile 101 \smile 11)$ and $\rx B = (00 \smile 001 \smile 10 \smile 110)$.
  Prove that $\rx A^*$ is unambiguous and $\rx B^*$ is ambiguous.
  Find the generating series (by length) for the set $\rl A^*$ produced by $\rx A^*$.
\end{xca}
\begin{sol}
  Notice that $\rx A$ is unambiguous.
  There is no way to combine any two of the three strings to create the other one:
  creating 00 from 101 and 11 is clearly impossible;
  11 from 00 and 101 can only be made by 101101 but 10 and 01 cannot be made by 00;
  101 cannot be made from 00 and 11 since there is no single 0.
  Therefore, $\rx A^*$ is unambiguous.

  For $\rx B$, notice that $00110 = (001)(10) = (00)(110)$, so it is ambiguous.

  By Theorem 3.13, $\Phi_{\rl A^*} = (A^*)(x) = \frac{1}{1-A(x)} = \frac{1}{1-2x^2-x^3}$.
\end{sol}

\begin{xca}
  For each of the following sets of binary strings,
  write an unambiguous expression which produces that set.
\end{xca}
\begin{enumerate}
  \item Binary strings that have no block of 0's of size 3,
        and no block of 1's of size 2.
        \begin{sol}
          A valid block of 0's is matched by $0 \smile 00 \smile 00000^*$.
          Likewise, a valid block of 1's is $1 \smile 1111^*$.
          Then, the block decomposition is
          \[
            \rx R = (\varepsilon \smile 0 \smile 0^2 \smile 0^40^*)
            ((1\smile 1^31^*)(0 \smile 0^2 \smile 0^40^*))^*
            (\varepsilon \smile 1 \smile 1^31^*)
          \]
          which is, as a block decomposition, unambiguous.
        \end{sol}
  \item Binary strings that have no substring of 0's of length 3,
        and no substring of 1's of length 2.
        \begin{sol}
          This means blocks of 0's have length 1 or 2, i.e., $(0 \smile 00)$
          and blocks of 1's have length 1, i.e., $(1)$.
          Then, the block decomposition is
          \[
            \rx R = (\varepsilon \smile 0 \smile 00)(1(0 \smile 00))^*(\varepsilon \smile 1)
          \]
          which an unambiguous block decomposition.
        \end{sol}
  \item Binary strings in which the substring 011 does not occur.
        \begin{sol}
          There are no ways that 011 overlaps itself.
          Therefore, we need only force blocks of 1's after a 0 to have length 1.
          Using a block decomposition depending if we start with 1 or 0,
          \[
            \rx R = \varepsilon \smile (1 1^*)(0 0^* 1)^*0^* \smile (00^*)(1 00^*)^*(\varepsilon \smile 1)
          \]
          which is unambiguous.
        \end{sol}
  \item Binary strings in which the blocks of 0's have even length and
        the blocks of 1's have odd length.
        \begin{sol}
          Blocks of 0's are matched by $00(00)^*$ and 1's by $1(11)^*$. Then,
          \[
            (00)^*(1(11)^*00(00)^*)^*(\varepsilon \smile 1(11)^*)
          \]
          is an unambiguous block decomposition.
        \end{sol}
\end{enumerate}

\begin{xca}
  Let $\rx G = 0^*((11)^*1(00)^*00 \smile (11)^*11(00)^*0)^*$,
  and let $\rl G$ be the set of binary strings produced by $\rx G$.
\end{xca}
\begin{enumerate}
  \item Give a verbal description of the strings in the set $\rl G$.
        \begin{sol}
          The set of binary strings where blocks of 0's
          have the opposite parity of the preceding block of 1's.
        \end{sol}
  \item Find the generating series (by length) of $\rl G$.
        \begin{sol}
          We know by Theorem 3.13 $\Phi_{\rl G}(x) = G(x)$, so
          \begin{align*}
            \Phi_{\rl G}(x)
             & = \frac{1}{1-x}\cdot\frac{1}{1-\qty(\frac{x}{1-x^2}\cdot\frac{x^2}{1-x^2} + \frac{x^2}{1-x^2}\cdot\frac{x}{1-x^2})} \\
             & = \frac{1}{1-x}\cdot\frac{1}{1-\frac{2x^3}{(1-x^2)^2}}                                                              \\
             & = \frac{1}{1-x}\cdot\frac{(1-x^2)^2}{(1-x^2)^2-2x^3}                                                                \\
             & = \frac{(1+x)(1-x^2)}{1-2x^2-2x^3+x^4}                                                                              \\
             & = \frac{1+x-x^2-x^3}{1-2x^2-2x^3+x^4}
          \end{align*}
          as desired.
        \end{sol}
  \item For $n \in \N$, let $g_n$ be the number of strings in $\rl G$ of length $n$.
        Give a recurrence relation and enough initial conditions
        to uniquely determine $g_n$ for all $n \in \N$.
        \begin{sol}
          Apply Theorem 4.8 and read off the linear recurrence relation:
          \[
            g_n - 2g_{n-2} - 2g_{n-3} + g_{n-4} = \begin{cases}
              1  & n = 0    \\
              1  & n = 1    \\
              -1 & n = 2    \\
              -1 & n = 3    \\
              0  & n \geq 4
            \end{cases}
          \]
          from which we calculate initial conditions $g_0 = 1$,
          $g_1 = 1$, $g_2 = 2g_0 - 1 = 1$, $g_3 = 2g_1 + 2g_0 - 1 = 3$.
        \end{sol}
\end{enumerate}

\begin{xca}\end{xca}
\begin{enumerate}
  \item Show that the generating series (by length) for binary strings
        in which every block of 0's has length at least 2
        and every block of 1's has length at least 3 is $\frac{(1-x+x^3)(1-x+x^2)}{1-2x+x^2-x^5}$.
        \begin{sol}
          This set of strings is produced by
          $\rx R = (\varepsilon \smile 000^*)(1111^*000^*)^*(\varepsilon \smile 1111^*)$.
          This leads to the rational function
          \begin{align*}
            R(x)
             & = \qty(1 + \frac{x^2}{1-x})\frac{1}{1-(\frac{x^3}{1-x}\cdot\frac{x^2}{1-x})}\qty(1 + \frac{x^3}{1-x}) \\
             & = \frac{1-x+x^2}{1-x}\cdot\frac{1}{1-\frac{x^5}{(1-x)^2}}\cdot\frac{1-x+x^3}{1-x}                     \\
             & = \frac{(1-x+x^2)(1-x+x^3)}{(1-x)^2}\cdot\frac{(1-x)^2}{(1-x)^2-x^5}                                  \\
             & = \frac{(1-x+x^2)(1-x+x^3)}{1-2x+x^2-x^5}
          \end{align*}
          which is equal to the generating series by Theorem 3.13.
        \end{sol}
  \item Give a recurrence relation and enough initial conditions to
        determine the coefficients of this power series.
        \begin{sol}
          Expand the numerator to get $\Phi_{\rl R}(x) = \frac{1-2x+2x^2-x^4+x^5}{1-2x+x^2-x^5}$.
          Then, apply Theorem 4.8 to read off the linear recurrence relation:
          \[
            r_n - 2r_{n-1} + r_{n-2} - r_{n-5} = \begin{cases}
              1  & n = 0    \\
              -2 & n = 1    \\
              2  & n = 2    \\
              0  & n = 3    \\
              -1 & n = 4    \\
              1  & n = 5    \\
              0  & n \geq 6
            \end{cases}
          \]
          and calculate $r_0 = 1$, $r_1 = -2 + 2r_0 = 0$,
          $r_2 = 2 + 2r_1 - r_0 = 1$, $r_3 = 0 + 2r_2 - r_1 = 2$,
          $r_4 = -1 + 2r_3 - r_2 = 2$, and $r_5 = 1 + 2r_4 - r_3 + r_0 = 4$.
        \end{sol}
\end{enumerate}

\begin{xca}\end{xca}
\begin{enumerate}
  \item For $n \in \N$, let $h_n$ be the number of binary strings of length $n$
        such that each even-length block of 0's is followed by a block of exactly one 1
        and each odd-length block of 0's is followed by a block of exactly two 1's.
        Show that $h_n = [x^n]\frac{1+x}{1-x^2-2x^3}$.
        \begin{sol}
          Let $\rl H$ be the relevant set and notice it is produced by
          the block decomposition $\rx H = 1^*(00(00)^*1 \smile 0(00)^*11)$.
          Note that since a block of 0's is followed by a block of 1's, we must end on a block of 1's.
          By Theorem 3.11, $\Phi_{\rl H}(x) = H(x)$ which is
          \begin{align*}
            H(x)
             & = \frac{1}{1-x}\cdot\frac{1}{1-(\frac{x^3}{1-x^2} + \frac{x^3}{1-x^2})} \\
             & = \frac{1}{1-x}\cdot\frac{1-x^2}{1-x^2-2x^3}                            \\
             & = \frac{1+x}{1-x^2-2x^3}
          \end{align*}
          and $h_n = [x^n]H(x)$ by Proposition 2.7, as desired.
        \end{sol}
  \item Give a recurrence relation and enough initial conditions to
        determine $h_n$ for all $n \in \N$.
        \begin{sol}
          Again, read off a recurrence relation from $H(x)$ by Theorem 4.8:
          \[
            h_n - h_{n-2} - 2h_{n-3} = \begin{cases}
              1 & n = 0    \\
              1 & n = 1    \\
              0 & n \geq 2
            \end{cases}
          \]
          and calculate $h_0 = 1$, $h_1 = 1$, $h_2 = 0 + h_0 = 1$,
          and $h_3 = 0 + h_1 + 2h_0 = 3$.
        \end{sol}
\end{enumerate}

\begin{xca}
  Let $\rl K$ be the set of binary strings in which any block of 1's
  which immediately follows a block of 0's must have length at least
  as great as the length of that block of 0's.
\end{xca}
\begin{enumerate}
  \item Derive a formula for $K(x) = \sum_{\kappa \in \rl K} x^{\ell(\kappa)}$.
        \begin{sol}
          First, we recursively define $\rx L = 11^* \smile 0\rx L 1$
          so that $\rl L = 0^i 1^j$ where $j \geq i \geq 1$ which is unambiguous.
          Now, define $\rx K = 1^*\rx L^* 0^*$ as a block decomposition.

          We can now calculate $L(x) = \frac{x}{1-x} + x^2L(x)$
          so $L(x) = \frac{x}{(1-x)(1-x^2)}$. Then,
          \begin{align*}
            K(x)
             & = \frac{1}{1-x}\cdot\frac{1}{1-\frac{x}{(1-x)(1-x^2)}}\cdot\frac{1}{1-x} \\
             & = \frac{1}{(1-x)^2}\cdot\frac{(1-x)(1-x^2)}{(1-x)(1-x^2)-x}              \\
             & = \frac{1+x}{1-2x-x^2+x^3}
          \end{align*}
          which is the generating series $\Phi_{\rl K}(x)$ by Theorem 3.11.
        \end{sol}
  \item Give a recurrence relation and enough initial conditions to
        determine the coefficients $[x^n]K(x)$ for all $n \in \N$.
        \begin{sol}
          Let $k_n = [x^n]K(x)$. By Theorem 4.8, we have the recurrence relation
          \[
            k_n - 2k_{n-1} - k_{n-2} + k_{n-3} = \begin{cases}
              1 & n = 0    \\
              1 & n = 1    \\
              0 & n \geq 2
            \end{cases}
          \]
          and calculate $k_0 = 1$, $k_1 = 1 + 2k_0 = 3$,
          and $k_2 = 0 + 2k_1 + k_0 = 7$.
        \end{sol}
\end{enumerate}

\begin{xca}\end{xca}
\begin{enumerate}
  \item Fix an integer $m \geq 1$.
        Find the generating series (by length) of the set of binary strings
        in which no block has length greater than $m$.
        \begin{sol}
          Blocks of 0's and 1's become $\smilesum_{i=1}^m 0^i$
          and $\smilesum_{i=1}^m 1^i$.
          Then, the block decomposition
          \[
            \rx R = (\smilesum_{i=0}^m 0^i)
            (\smilesum_{i=1}^m 1^i\smilesum_{i=1}^m 0^i)^*
            (\smilesum_{i=0}^m 1^i)
          \]
          produces our desired set.
          By Theorem 3.11, the generating series $\Phi_{\rl R}(x) = R(x)$ which is
          \begin{align*}
            R(x)
             & = \qty(\sum_{i=0}^m x^i)\qty(\frac{1}{1-(\sum_{i=1}^m x^i)^2})\qty(\sum_{i=0}^m x^i) \\
             & = \qty(\frac{1-x^{m+1}}{1-x})^2\qty(\frac{1}{1-(\frac{x-x^{m+1}}{1-x})^2})           \\
             & = \frac{(1-x^{m+1})^2}{(1-x)^2}\cdot\frac{(1-x)^2}{(1-x)^2-(x-x^{m+1})^2}            \\
             & = \frac{(1-x^{m+1})^2}{(1-x)^2-(x-x^{m+1})^2}
          \end{align*}
          which I'm sure simplifies further.
        \end{sol}
  \item Fix integers $m, k \geq 1$.
        Find the generating series (by length) of the set of binary strings
        in which no block of 0's has length greater than $m$
        and no block of 1's has length greater than $k$.
        \begin{sol}
          Proceed as above: we instead get the block decomposition
          \[
            \rx R = (\smilesum_{i=0}^m 0^i)
            (\smilesum_{i=1}^k 1^i\smilesum_{i=1}^m 0^i)^*
            (\smilesum_{i=0}^k 1^i)
          \]
          which produces the set we want. By Theorem 3.11,
          \begin{align*}
            \Phi_{\rl R}(x)
             & = R(x)                                                                                                                   \\
             & = \qty(\sum_{i=0}^m x^i)\qty(\frac{1}{1-(\sum_{i=1}^k x^i)(\sum_{i=1}^m x^i)})\qty(\sum_{i=0}^k x^i)                     \\
             & = \qty(\frac{1-x^{m+1}}{1-x})\qty(\frac{1}{1-(\frac{x-x^{k+1}}{1-x})(\frac{x-x^{m+1}}{1-x})})\qty(\frac{1-x^{k+1}}{1-x}) \\
             & = \frac{(1-x^{m+1})(1-x^{k+1})}{(1-x)^2}\cdot\frac{(1-x)^2}{(1-x)^2 - (x-x^{k+1})(x-x^{m+1})}                            \\
             & = \frac{(1-x^{m+1})(1-x^{k+1})}{(1-x)^2 - (x-x^{k+1})(x-x^{m+1})}                                                        \\
          \end{align*}
          as desired.
        \end{sol}
\end{enumerate}

\begin{xca}
  Let $\rl L$ be the set of binary strings in which
  each block of 1's has odd length, and which do not contain the substring 0001.
  Let $\rl L_n$ be the set of strings in $\rl L$ of length $n$
  and let $L(x) = \sum_{n=0}^\infty \abs{\rl L_n}x^n$.
\end{xca}
\begin{enumerate}
  \item Give an expression that produces the set $\rl L$ unambiguously,
        and explain briefly why it is unambiguous and produces $\rl L$.
        \begin{sol}
          Notice that 0001 does not overlap itself.
          Then, we need only prevent a non-terminal block of 3 or more 0's.
          Also, blocks of 1's must be odd.
          Write $\rx L = (\varepsilon \smile 1(11)^*)((0 \smile 00)1(11)^*)^*0^*$
          and notice it is unambiguous as a block decomposition.
        \end{sol}
  \item Use your expression from part (a) to show that
        $L(x) = \frac{1+x-x^2}{1-x-x^2+x^3+x^4}$.
        \begin{sol}
          By Theorem 3.11, the generating series $L(x)$ is
          \begin{align*}
            L(x)
             & = (1+\frac{x}{1-x^2})\frac{1}{1-\frac{(x+x^2)x}{1-x^2}}\frac{1}{1-x} \\
             & = \frac{1+x-x^2}{(1-x^2)(1-x)}\cdot\frac{1-x^2}{1-x^2-(x+x^2)x}      \\
             & = \frac{1+x-x^2}{(1-x)(1-2x^2-x^3)}                                  \\
             & = \frac{1+x-x^2}{1-x-x^2+x^3+x^4}
          \end{align*}
          as desired.
        \end{sol}
\end{enumerate}

\begin{xca}
  Let $\rl M$ be the set of binary strings in which
  each block of 0's has length at most two
  and which do not contain 00111 as a substring.
  Let $\rl M_n$ be the set of strings in $\rl M$ of length $n$
  and let $M(x) = \sum_{n=0}^\infty \abs{\rl M_n}x^n$.
\end{xca}
\begin{enumerate}
  \item Give an expression that produces the set $\rl M$ unambiguously,
        and explain briefly why it is unambiguous and produces $\rl M$.
        \begin{sol}
          Write $\rx M = 1^*(011^* \smile (001 \smile 0011))^*(\varepsilon \smile 0 \smile 00)$.
          We split the middle blocks by whether there are one or two zeroes.
          If there are two zeroes, then we can only have two ones to avoid 00111.
          This is unambiguous as it is an (albeit weird-looking) block decomposition.
        \end{sol}
  \item Use your expression from part (a) to show that $M(x) = \frac{1+x+x^2}{1-x-x^2-x^3+x^5}$.
        \begin{sol}
          Write by Theorem 3.11 that
          \begin{align*}
            M(x)
             & = \frac{1}{1-x}\cdot\frac{1}{1-(\frac{x^2}{1-x}+x^3+x^4)}\cdot(1+x+x^2) \\
             & = \frac{1+x+x^2}{1-x}\cdot\frac{1-x}{(1-x^3-x^4)(1-x)-x^2}              \\
             & = \frac{1+x+x^2}{1-x-x^2-x^3+x^5}
          \end{align*}
          as desired.
        \end{sol}
\end{enumerate}

\begin{xca}
  Let $\rl N$ be the set of binary strings in which
  each block of 0's has odd length
  and each block of 1's has length 1 or 2.
  Let $\rl N_n$ be the set of strings in $\rl N$ of length $n$
  and let $N(x) = \sum_{n=0}^\infty \abs{\rl N_n}x^n$.
\end{xca}
\begin{enumerate}
  \item Show that $N(x) = \frac{1+2x+x^2-x^4}{1-2x^2-x^3} = -2+x+\frac{3+x-3x^2}{1-2x^2-x^3}$.
        \begin{sol}
          Write $\rx N = (\varepsilon \smile 0(00)^*)((1\smile 11)0(00)^*)^*(\varepsilon\smile 1\smile 11)$.
          By Theorem 3.11,
          \begin{align*}
            N(x)
             & = \qty(1+\frac{x}{1-x^2})\cdot\frac{1}{1-\frac{(x+x^2)x}{1-x^2}}\cdot(1+x+x^2) \\
             & = \frac{(1+x-x^2)(1+x+x^2)}{1-x^2}\cdot\frac{1-x^2}{(1-x^2)-(x^2+x^3)}         \\
             & = \frac{(1+x-x^2)(1+x+x^2)}{1-2x^2-x^3}                                        \\
             & = \frac{1+2x+x^2-x^4}{1-2x^2-x^3}
          \end{align*}
          as desired.
        \end{sol}
  \item Derive an exact formula for $\abs{\rl N_n}$ as a function of $n$.
        \begin{sol}
          Apply partial fractions on $\frac{3+x-3x^2}{1-2x^2-x^3} = \frac{A}{1+x} + \frac{B+Cx}{1-x-x^2}$.
          Equate numerators to get $3+x-3x^2 = A(1-x-x^2) + (B+Cx)(1+x) = (A+B) + (-A+B+C)x + (-C)x^2$.

          This gives the system
          \[ \systeme[ABC]{A+B=3,-A+B+C=1,-A+C=-3} \]
          which solves to $A=-1$, $B=-4$, $C=4$.
          Finally, we have that
          \begin{align*}
            [x^n]\frac{3+x-3x^2}{1-2x^2-x^3}
             & = -[x^n]\frac{1}{1+x}-4[x^n]\frac{1}{1-x-x^2}+4[x^n]\frac{x}{1-x-x^2} \\
             & = -(-1)^n - 4f_n + 4f_{n-1}                                           \\
             & = (-1)^{n+1} - 4(f_n - f_{n-1})                                       \\
             & = 4f_{n-2} - (-1)^n
          \end{align*}
          where $f_n$ is the $n$th Fibonacci number.
        \end{sol}
\end{enumerate}

\begin{xca}
  For $n \in N$, let $p_n$ be the number of binary strings of length $n$
  in which every block of 0's is followed by a block of 1's with the same parity of length.
\end{xca}
\begin{enumerate}
  \item Determine the generating series $P(x) = \sum_{n=0}^\infty p_n x^n$
        \begin{sol}
          Write $\rx P = 1^*(00(00)^*11(11)^* \smile 0(00)^*1(11)^*)0^*$.
          Then, by Theorem 3.11,
          \begin{align*}
            P(x)
             & = \frac{1}{1-x}\cdot\frac{1}{1-(\frac{x^4}{(1-x^2)^2} + \frac{x^2}{(1-x^2)^2})}\cdot\frac{1}{1-x} \\
             & = \frac{1}{(1-x)^2}\cdot\frac{1}{1-\frac{x^4+x^2}{(1-x^2)^2}}                                     \\
             & = \frac{1}{(1-x)^2}\cdot\frac{(1-x^2)^2}{(1-x^2)^2-x^2-x^4}                                       \\
             & = \frac{1+2x+x^2}{1-3x^2}
          \end{align*}
          as desired.
        \end{sol}
  \item Show that if $n \geq 2$, then $p_n = 2\cdot 3^{\floor{n/2}-1}$.
        \begin{sol}
          By part (a), we have that
          \begin{align*}
            p_n
             & = [x^n] \frac{1+2x+x^2}{1-3x^2}                                              \\
             & = [x^n] \frac{1}{1-3x^2} + 2[x^n] \frac{x}{1-3x^2} + [x^n]\frac{x^2}{1-3x^2} \\
             & = a_n + 2a_{n-1} + a_{n-2}
          \end{align*}
          where $\sum a_n x^n = \frac{1}{1-3x^2}$ which is valid because $n \geq 2$.
          Notice that $\frac{1}{1-3x^2} = \sum 3^n x^{2n}$.
          If $n$ is even, then we have $3^{n/2}+ 2(0) + 3^{n/2-1} = 6\cdot 3^{\floor{n/2}-1}$.
          If $n$ is odd, then we have $0 + 2\cdot 3^{(n-1)/2} + 0 = 2\cdot 3^{\floor{n/2}-1}$.

          Which isn't right???
        \end{sol}
\end{enumerate}

\end{document}
